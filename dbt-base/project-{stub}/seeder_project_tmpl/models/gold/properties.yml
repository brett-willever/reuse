shared: &shared
  database: '{{env_var("BIGQUERY_PROJECT_ID")}}'
  loader: iota
  # loaded_at_field: _dvp_metadata.loaded_at
  # config:
  #   enabled: true
  # freshness:
  #   warn_after:
  #     count: 7
  #     period: day
  #   error_after:
  #     count: 30
  #     period: day
  meta:
    quality: low

version: 2


## *********************
##  Source Configuration
## *********************
sources:
  - name: silver_us
    description: Silver group/domain assets prepped for metric adherance 
    schema: silver_us
    tags:
      - sbac
    <<: *shared

    tables:
      - name: assessments_sbac
        description: Assessments (SBAC)
        meta:
          source_definition: Assessment English Language Arts/Literacy and Mathematics Smarter Balanced Summative Assessment (SBAC)
          category: School [District] Academic Performance
          depth: 1
        # loaded_at_field: _dvp_metadata.loaded_at
        # tests:
        #   - not_null
        tags:
          - sbac
        # freshness:
        #   warn_after:
        #     count: 7
        #     period: day
        #   error_after:
        #     count: 14
        #     period: day
      
      - name: academic_indicators_ela
        description: Academic Indicators ELA
        meta:
          category: School [District] Academic Indicators
          depth: 1
        # loaded_at_field: _dvp_metadata.loaded_at
        # tests:
        #   - not_null
        tags:
          - ela
        # freshness:
        #   warn_after:
        #     count: 7
        #     period: day
        #   error_after:
        #     count: 14
        #     period: day
## *********************
##  Model Configuration
## *********************
models:
  - name: assessments_scores
    description: CASSPP - ELA - % Meeting Standard [Alternate] 
    schema: gold_us
    docs:
      show: true
      node_color: "#C0C0C0"
    config:
      unique_key: [surrogate_key]
      updated_at: _dvp_metadata.loaded_at
      materialized: incremental
      full-refresh: true
      on_schema_change: fail
      contract:
        # enforced: true
        alias_types: false
    columns: [
        {
          "name": "surrogate_key",
          "data_type": "INT64"
        },
        {
          "name": "county_code",
          "data_type": "INT64"
        },
        {
          "name": "district_code",
          "data_type": "INT64"
        },
        {
          "name": "school_code",
          "data_type": "INT64"
        },
        {
          "name": "filler",
          "data_type": "STRING"
        },
        {
          "name": "test_year",
          "data_type": "INT64"
        },
        {
          "name": "student_group_id",
          "data_type": "STRING"
        },
        {
          "name": "test_type",
          "data_type": "STRING"
        },
        {
          "name": "total_tested_at_reporting_level",
          "data_type": "STRING"
        },
        {
          "name": "total_tested_with_scores_at_reporting_level",
          "data_type": "STRING"
        },
        {
          "name": "grade",
          "data_type": "INT64"
        },
        {
          "name": "test_id",
          "data_type": "INT64"
        },
        {
          "name": "students_enrolled",
          "data_type": "INT64"
        },
        {
          "name": "students_tested",
          "data_type": "INT64"
        },
        {
          "name": "mean_scale_score",
          "data_type": "FLOAT64"
        },
        {
          "name": "percentage_standard_exceeded",
          "data_type": "FLOAT64"
        },
        {
          "name": "percentage_standard_met",
          "data_type": "FLOAT64"
        },
        {
          "name": "Percentage_Standard_Met_And_Above",
          "data_type": "FLOAT64"
        },
        {
          "name": "percentage_standard_nearly_met",
          "data_type": "FLOAT64"
        },
        {
          "name": "percentage_standard_not_met",
          "data_type": "FLOAT64"
        },
        {
          "name": "Students_with_Scores",
          "data_type": "INT64"
        },
        {
          "name": "area_1_percentage_above_standard",
          "data_type": "FLOAT64"
        },
        {
          "name": "area_1_percentage_near_standard",
          "data_type": "FLOAT64"
        },
        {
          "name": "area_1_percentage_below_standard",
          "data_type": "FLOAT64"
        },
        {
          "name": "area_2_percentage_above_standard",
          "data_type": "FLOAT64"
        },
        {
          "name": "area_2_percentage_near_standard",
          "data_type": "FLOAT64"
        },
        {
          "name": "area_2_percentage_below_standard",
          "data_type": "FLOAT64"
        },
        {
          "name": "area_3_percentage_above_standard",
          "data_type": "FLOAT64"
        },
        {
          "name": "area_3_percentage_near_standard",
          "data_type": "FLOAT64"
        },
        {
          "name": "area_3_percentage_below_standard",
          "data_type": "FLOAT64"
        },
        {
          "name": "area_4_percentage_above_standard",
          "data_type": "FLOAT64"
        },
        {
          "name": "area_4_percentage_near_standard",
          "data_type": "FLOAT64"
        },
        {
          "name": "area_4_percentage_below_standard",
          "data_type": "FLOAT64"
        },
        {
          "name": "type_id",
          "data_type": "STRING"
        }
      ]

  - name: per_pupil_spend
    description: Per Pupil Spend
    schema: gold_us
    docs:
      show: true
      node_color: "#C0C0C0"
    config:
      unique_key: [surrogate_key]
      updated_at: _dvp_metadata.loaded_at
      materialized: incremental
      full-refresh: true
      on_schema_change: fail
      transformation: |
        
    columns:
      [{
        "name": "County",
        "data_type": "STRING"
      }, {
        "name": "LEA_Name",
        "data_type": "STRING"
      }, {
        "name": "LEA_CDS_Code",
        "data_type": "INT64"
      }, {
        "name": "School_Name",
        "data_type": "STRING"
      }, {
        "name": "School_CDS_Code",
        "data_type": "INT64"
      }, {
        "name": "School_Expenditures___Federal",
        "data_type": "STRING"
      }, {
        "name": "School_Expenditures___State___Local",
        "data_type": "STRING"
      }, {
        "name": "Central_Expenditures___Federal",
        "data_type": "STRING"
      }, {
        "name": "Central_Expenditures___State___Local",
        "data_type": "STRING"
      }]