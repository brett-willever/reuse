shared: &shared
  database: '{{env_var("BIGQUERY_PROJECT_ID")}}'
  loader: iota
  # loaded_at_field: _dvp_metadata.loaded_at
  # config:
  #   enabled: true
  # freshness:
  #   warn_after:
  #     count: 90
  #     period: day
  #   error_after:
  #     count: 365
  #     period: day
  meta:
    quality: low

version: 2

## *********************
##  Source Configuration
## *********************
sources:
  - name: staging_us
    description: Staging / Bronze Assets
    tags:
      - SBAC
    <<: *shared

    tables:
      - name: academic_indicators_ela
      - name: academic_graduation_rate
        description: Graduation Rate
      - name: assessments_sbac
        description: Assessments (SBAC)
        meta:
          source_definition: Assessment English Language Arts/Literacy and Mathematics Smarter Balanced Summative Assessment (SBAC)
          category: School [District] Academic Performance
          depth: 1
        # loaded_at_field: _dvp_metadata.loaded_at
        # tests:
        #   - not_null
        tags:
          - SBAC
        freshness:
          warn_after:
            count: 7
            period: day
          error_after:
            count: 14
            period: day

## *********************
##  Model Configuration
## *********************
models:
  - name: academic_indicators_ela
    config:
      enabled: true
      database: '{{env_var("BIGQUERY_PROJECT_ID")}}'
      full_refresh: true
      materialized: incremental
      on_schema_change: fail
    columns:
      - name: cds
      - name: rtype
      - name: schoolname
      - name: districtname
      - name: countyname
      - name: charter_flag
      - name: coe_flag
      - name: dass_flag
      - name: studentgroup
      - name: currdenom
      - name: currstatus
      - name: priordenom
      - name: priorstatus
      - name: change
      - name: statuslevel
      - name: changelevel
      - name: color
      - name: box
      - name: currnsizemet
      - name: priornsizemet
      - name: accountabilitymet
      - name: hscutpoints
      - name: pairshare_method
      - name: currprate_enrolled
      - name: currprate_tested
      - name: currprate
      - name: currnumPRLOSS
      - name: currdenom_withoutPRLOSS
      - name: currstatus_withoutPRLOSS
      - name: priorprate_enrolled
      - name: priorprate_tested
      - name: priorprate
      - name: priornumPRLOSS
      - name: priordenom_withoutPRLOSS
      - name: priorstatus_withoutPRLOSS
      - name: indicator
      - name: reportingyear
  - name: assessments_sbac
    config:
      enabled: true
      database: '{{env_var("BIGQUERY_PROJECT_ID")}}'
      full_refresh: true
      materialized: incremental
      on_schema_change: fail
      columns:
        - name: county_code
          data_type: int64
        - name: district_code
          data_type: int64
        - name: school_code
          data_type: int64
        - name: filler
        - name: test_year
        - name: student_group_id
        - name: test_type
        - name: total_tested_at_reporting_level
        - name: total_tested_with_scores_at_reporting_level
        - name: grade
        - name: test_id
        - name: students_enrolled
        - name: students_tested
        - name: mean_scale_score
        - name: percentage_standard_exceeded
        - name: percentage_standard_met
        - name: Percentage_Standard_Met_And_Above
        - name: percentage_standard_nearly_met
        - name: percentage_standard_not_met
        - name: Students_with_Scores
        - name: area_1_percentage_above_standard
        - name: area_1_percentage_near_standard
        - name: area_1_percentage_below_standard
        - name: area_2_percentage_above_standard
        - name: area_2_percentage_near_standard
        - name: area_2_percentage_below_standard
        - name: area_3_percentage_above_standard
        - name: area_3_percentage_near_standard
        - name: area_3_percentage_below_standard
        - name: area_4_percentage_above_standard
        - name: area_4_percentage_near_standard
        - name: area_4_percentage_below_standard
        - name: type_id

  - name: academic_graduation_rate
    config:
      enabled: true
      database: '{{env_var("BIGQUERY_PROJECT_ID")}}'
      full_refresh: true
      materialized: incremental
      on_schema_change: fail
      # sort: event_time
      # dist: event_id
      contract:
        enforced: false
      cluster_by:
        - aggregatelevel
    columns:
      - name: academicyear
        data_type: int64
        # constraints:
        #   - type: not_null
        expr: CAST(academicYear AS FLOAT64) --cash
        mode: REQUIRED
      - name: aggregatelevel
        data_type: int64
        # constraints:
        #   - type: not_null
      - name: countycode
        data_type: int64
      - name: districtcode
        data_type: int64
      - name: schoolcode
        data_type: int64
      - name: countyname
        data_type: string
      - name: districtname
        data_type: string
      - name: schoolname
        data_type: string
      - name: charterschool
        data_type: string
      - name: dass
        data_type: string
      - name: reportingcategory
        data_type: string
        # constraints:
        #   - type: not_null
      - name: cohortstudents
        data_type: int64
      - name: regular_hs_diploma_graduates__count_
        data_type: int64
      - name: regular_hs_diploma_graduates__rate_
        data_type: float64
      - name: met_uc_csu_grad_req_s__count_
        data_type: int64
      - name: met_uc_csu_grad_req_s__rate_
        data_type: float64
      - name: seal_of_biliteracy__count_
        data_type: int64
      - name: seal_of_biliteracy__rate_
        data_type: float64
      - name: golden_state_seal_merit_diploma__count_
        data_type: int64
      - name: golden_state_seal_merit_diploma__rate
        data_type: float64
      - name: chspe_completer__count_
        data_type: int64
      - name: chspe_completer__rate_
        data_type: float64
      - name: adult_ed__hs_diploma__count_
        data_type: int64
      - name: adult_ed__hs_diploma__rate_
        data_type: float64
      - name: sped_certificate__count_
        data_type: int64
      - name: sped_certificate__rate_
        data_type: float64
      - name: ged_completer__count_
        data_type: int64
      - name: ged_completer__rate_
        data_type: float64
      - name: other_transfer__count_
        data_type: int64
      - name: other_transfer__rate_
        data_type: float64
      - name: dropout__count_
        data_type: int64
      - name: dropout__rate_
        data_type: float64
      - name: still_enrolled__count_
        data_type: int64
      - name: still_enrolled__rate_
        data_type: float64
